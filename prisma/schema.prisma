// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Patient {
  id              String         @id @default(cuid())
  fio             String
  birthYear       Int
  diagnosis       String
  attendingDoctor String
  prescriptions   Prescription[]
  dispensations   Dispensation[]
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
}

model Medicine {
  id                       String         @id @default(cuid())
  smmnNodeCode             String
  section                  String
  standardizedMnn          String
  tradeNameVk              String
  standardizedDosageForm   String
  standardizedDosage       String
  characteristic           String
  packaging                Int
  price                    Float
  prescriptions            Prescription[]
  dispensations            Dispensation[]
  createdAt                DateTime       @default(now())
  updatedAt                DateTime       @updatedAt
}

model Prescription {
  id                 String   @id @default(cuid())
  patientId          String
  medicineId         String
  dailyDose          String
  dailyConsumption   Float
  annualRequirement  Float
  patient            Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  medicine           Medicine @relation(fields: [medicineId], references: [id], onDelete: Cascade)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@unique([patientId, medicineId])
}

model Dispensation {
  id               String   @id @default(cuid())
  patientId        String
  medicineId       String
  dispensationDate DateTime
  quantity         Int
  patient          Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  medicine         Medicine @relation(fields: [medicineId], references: [id], onDelete: Cascade)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}
